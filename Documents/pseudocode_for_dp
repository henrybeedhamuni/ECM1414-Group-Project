function dp_planner(activities, max_time, budget):
    n = length of activities
    
    dp = 2d table of size (max_time + 1) x (budget + 1), all initialized to 0
    snapshots = empty list
    
    for i from 0 to n - 1:
        append copy of dp to snapshots
        
        activity = activities[i]
        
        for t from max_time down to activity.duration:
            for b from budget down to activity.cost:
                candidate = dp[t - activity.duration][b - activity.cost] + activity.enjoyment_level
                
                if candidate > dp[t][b]:
                    dp[t][b] = candidate
    
    best_enjoyment = 0
    best_t = 0
    best_b = 0
    
    for t from 0 to max_time:
        for b from 0 to budget:
            if dp[t][b] > best_enjoyment:
                best_enjoyment = dp[t][b]
                best_t = t
                best_b = b
    
    selected_ids = empty list
    t = best_t
    b = best_b
    
    for i from n - 1 down to 0:
        activity = activities[i]
        prev = snapshots[i]
        
        if t >= activity.duration and b >= activity.cost:
            if dp[t][b] != prev[t][b]:
                append i to selected_ids
                t = t - activity.duration
                b = b - activity.cost
        
        dp = prev
    
    selected_ids = reverse of selected_ids
    
    total_cost = sum of all activity.cost for indices in selected_ids
    total_time = sum of all activity.duration for indices in selected_ids
    total_enjoyment = sum of all activity.enjoyment_level for indices in selected_ids
    
    best_solution = [selected_ids, total_cost, total_time, total_enjoyment]
    
    return best_solution







    